{"filter":false,"title":"myfollow.blade.php","tooltip":"/resources/views/myfollow.blade.php","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":106,"column":6},"end":{"row":107,"column":0},"action":"insert","lines":["",""],"id":41}],[{"start":{"row":107,"column":0},"end":{"row":571,"column":9},"action":"insert","lines":["</div>","<?php","        if(isset($_POST['speech'])){","            $GLOBALS['speech'] = $_POST['speech'];","        }","        else{","          $GLOBALS['speech'] = \"\";","        }","        ","        ","          if(isset($_GET['allstock'])){          ","            $GLOBALS['allstock'] = $allstock->point.\"  而近期漲幅則是\".$allstock->direction.\"了\".$allstock->rate;        ","          }","          else{","            $GLOBALS['allstock'] = '';","          }","          ","          if(isset($_GET['finish'])){","              $GLOBALS['finish'] = $_GET['finish'];","          }","          else{","            $GLOBALS['finish'] = '';","          }","          ","        ","?>","<div id = \"result\"></div>","<div id = \"show\"></div>","<div style=\"display:none\">","  <div class=\"button\" id = 'press' onclick=\"speak();\">Speak</div>","</div>","    <script>","      var speech = \"<?php echo $GLOBALS['speech']; ?>\";","      var finish = \"<?php echo $GLOBALS['finish']; ?>\";","      function speak () {","        var twindex = [\"上市\",\"上櫃\",\"電子\",\"金融\"];","        var allstock = \"<?php echo $GLOBALS['allstock']; ?>\";","        for(var i=0;i<twindex.length;i++){","          if(speech.indexOf(twindex[i])!=-1&&speech!=\"\"){","            speech = \"台股\"+speech+\"指數為\";","          }","        }","        speech = speech+allstock;","        var show = document.getElementById(\"show\");","        var msg = new SpeechSynthesisUtterance();","        msg.lang = \"zh-TW\"","        msg.text = speech;","        msg.volume = 60;","        ","        window.speechSynthesis.speak(msg);","        function _wait() {","          if ( ! window.speechSynthesis.speaking && speech!=\"\" && finish==\"\") {","            convert();","            return;","          }","          else if(! window.speechSynthesis.speaking && speech!=\"\" && finish!=\"\"){","            start();","            return;","          }","          window.setTimeout( _wait, 200 );","        }","        _wait();","      };","</script>","    ","<script>","document.getElementById(\"press\").click();","</script>","","<!--<button onclick=\"convert();\"><i class=\"fa fa-microphone\"></i></button>-->","<script>","","function convert(){","  var r = document.getElementById('result');","  if('webkitSpeechRecognition' in window){","\t\t\t\t\tvar speechRecognizer = new webkitSpeechRecognition();","\t\t\t\t\tspeechRecognizer.continuous = false;","\t\t\t\t\tspeechRecognizer.interimResults = false;","\t\t\t\t\tspeechRecognizer.lang = 'cmn-Hant-TW';","\t\t\t\t\tspeechRecognizer.start();","\t\t\t\t\t","\t\t\t\t\tspeechRecognizer.status = true;","\t\t\t\t\tshow.innerHTML = \"convert\"","          ","          setTimeout(function(){","            speechRecognizer.status=false;","            speechRecognizer.stop();","          },10000);","          speechRecognizer.onend=function(event){","              if(speechRecognizer.status===true){","                speechRecognizer.start();","                show.innerHTML = \"on\";","              }else{","                document.getElementById(\"S\").click();","              }","          }","          show.innerHTML = \"off\";","\t\t\t\t\tvar finalTranscripts = '';","\t\t\t\t\tspeechRecognizer.onresult = function(event){","\t\t\t\t\t\tvar interimTranscripts = '';","\t\t\t\t\t\tfor(var i = event.resultIndex; i < event.results.length; i++){","\t\t\t\t\t\t\tvar transcript = event.results[i][0].transcript;","\t\t\t\t\t\t\ttranscript.replace(\"\\n\", \"<br>\");","\t\t\t\t\t\t\tif(event.results[i].isFinal){","\t\t\t\t\t\t\t\tfinalTranscripts += transcript;","\t\t\t\t\t\t\t}else{","\t\t\t\t\t\t\t\tinterimTranscripts += transcript;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t\tr.innerHTML = finalTranscripts + '<span style=\"color:#999\">' + interimTranscripts + '</span>';","\t\t\t\t\t  if(finalTranscripts!=\"\"){","","\t\t\t\t\t    var url = \"?value=\"+finalTranscripts;","\t\t\t\t\t    document.location.href= url;","\t\t\t\t\t  }","\t\t\t\t\t  ","\t\t\t\t\t};","\t\t\t\t\tspeechRecognizer.onerror = function (event) {","\t\t\t\t\t};","\t\t\t\t}else{","\t\t\t\t\tr.innerHTML = 'Your browser is not supported. If google chrome, please upgrade!';","\t\t\t\t}","\t\t\t\t","}","","</script>","<div style=\"display:none\">","  <div class=\"button\" id = 'S' onclick=\"start();\">Speak</div>","</div>","","<script>","      function sleep(delay) {","        var start = new Date().getTime();","        while (new Date().getTime() < start + delay);","      }","","      function start(){","          var show = document.getElementById(\"show\");","          show.innerHTML = \"start\";","          var recognition = new webkitSpeechRecognition();","          recognition.coninuous = true;","          recognition.interimResults = true;","          recognition.lang = \"cmn-Hant-TW\";","          recognition.status = true;","      ","      ","          recognition.onend=function(){","\t              if(recognition.status===true){","\t\t                if(finalResult.match(\"安安\")!=null){","\t\t \t                  var speech = \"聽到了\";","        \t              var msg = new SpeechSynthesisUtterance();","        \t              msg.lang = \"zh-TW\"","        \t              msg.text = speech;","        \t              msg.volume = 60;","        \t              window.speechSynthesis.speak(msg);","        \t              sleep(1000);","\t\t\t                  convert();","\t\t                }else{","\t\t                    finalResult = '';","\t\t                    recognition.start();","\t\t                }","\t\t          ","                }else{","                  recognition.start();","                }","            }","","            var finalResult = '';","            recognition.onresult = function(event){","\t          var interimResults = '';","\t          for (var i = event.resultIndex;i<event.results.length;i++){","\t\t        var transcript = event.results[i][0].transcript;","\t\t            transcript.replace(\"\\n\",\"<br>\");","\t\t            if(event.results[i].isFinal){","\t\t\t              finalResult += transcript;","\t\t            }else{","\t\t\t              interimResults += transcript;","\t\t            }","\t          }","","            }","","","              recognition.start();","            ","      }","","  ","</script>","<script >","","var speechjudge = \"<?php echo $GLOBALS['speech']  ?>\";","if(speechjudge==\"\"){","  document.getElementById(\"S\").click();","}","  ","","</script>","","<?php","","chdir('/home/ubuntu/workspace/');","require_once ('vendor/autoload.php');","use ApiAi\\Client;","","if(isset($_GET['value'])){","  try {","    $client = new Client('b7b343928ad14b38b4cd75bfec713cd6');","    $query = $client->get('query', [","        'query'     => $_GET['value'],","        'sessionId' => time()","    ]);","","    $response = json_decode((string) $query->getBody(), true);","} catch (\\Exception $error) {","    echo $error->getMessage();","}","}","?>","","<?php","$GLOBALS['url'] = '';","  if(isset($response['result']['parameters']['stockname'])){","        $url='http://chatbot-joey820924.c9users.io/stock/detailcode/'.$response['result']['parameters']['stockname'].\"?Index=\".$response['result']['parameters']['Index'];","        $GLOBALS['url'] = $url;","","        }","  else if(isset($response['result']['parameters']['judge'])){","    $index = is_array($response['result']['parameters']['Index'])?$response['result']['parameters']['Index'][0]:$response['result']['parameters']['Index'];","    if(isset($response['result']['parameters']['Index1'])){","      $index1 = is_array($response['result']['parameters']['Index1'])?$response['result']['parameters']['Index1'][0]:$response['result']['parameters']['Index1'];","    }","    else{","      $index1 = NULL;","    }","    $name = [];","    $judge = $response['result']['parameters']['judge'];","    $judge1 = isset($response['result']['parameters']['judge1'])?$response['result']['parameters']['judge1']:NULL;","    $judge2 = isset($response['result']['parameters']['judge2'])?$response['result']['parameters']['judge2']:NULL;","    $judge3 = isset($response['result']['parameters']['judge3'])?$response['result']['parameters']['judge3']:NULL;","    ","    $statement = \"\";","    ","    ","    ","    if(empty($index1)){","      #單一判斷","        if($index==\"price\"){","          #股價判斷","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          if(false==empty($judge1)){","            $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","            $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'];","          }","          else{","            $statement = $judge.\"=\".$response['result']['parameters']['number'];","          }","        }else{","          #指標判斷","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          if(false==empty($judge1)){","            $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","            $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'];","          }else{","            $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'];","          }","        }","    }","    ","    ","    else{","      #多重判斷","     if(false == empty($judge3)){","      #total 4","      if($index==\"price\"){","        $judge = $judge==\"大於\"?\"pl\":\"pt\";","        $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","        $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","        $judge3 = $judge3==\"大於\"?\"igt\":\"ilt\";","        $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&sindex=\".$index1.\"&\".$judge2.\"=\".$response['result']['parameters']['number2'].\"&\".$judge3.\"=\".$response['result']['parameters']['number3'];","        ","      }","      else{","        $judge = $judge==\"大於\"?\"igt\":\"ilt\";","        $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","        $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","        $judge3 = $judge3==\"大於\"?\"pl\":\"pt\";","        $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'].\"&\".$judge3.\"=\".$response['result']['parameters']['number3'];","      }","    }","    else if(false == empty($judge2)){","      #total 3","      $str = $response['result']['resolvedQuery'];","      $index_position = strpos($str,$index);","      $index1_position = strpos($str,$index1);","      $judge_position = strpos($str,$judge);","      $judge1_position = strpos($str,$judge1,$judge_position+2);","      $judge2_position = strpos($str,$judge2,$judge1_position+2);","      if($judge1_position>$index1_position){","        #前1後2","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&sindex=\".$index1.\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","      }","      }","      else if($judge1_position<$index_position){","        #前2後1","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&sindex=\".$index1.\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }","        ","      }","      else if($judge2_position<$index1_position and $judge_position>$index_position){","        #比距離","        if($judge2_position-$judge1_position>$judge1_position-$judge_position){","          #前2後1","          if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&sindex=\".$index1.\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }","        }","        else{","          #前1後2","          if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&sindex=\".$index1.\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }","        }","      }","      else if($judge2_position<$index1_position){","        #前1後2","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&sindex=\".$index1.\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }","      }","      else{","        #前2後1","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge1==\"大於\"?\"pl\":\"pt\";","          $judge2 = $judge2==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&sindex=\".$index1.\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge1==\"大於\"?\"igt\":\"ilt\";","          $judge2 = $judge2==\"大於\"?\"pl\":\"pt\";","          $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'].\"&\".$judge2.\"=\".$response['result']['parameters']['number2'];","        }","      }","    }","    else if(false == empty($judge1)){","      #total 2","      if($judge==$judge1){","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge==\"大於\"?\"igt\":\"ilt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&sindex=\".$index1.\"&\".$judge1.\"=\".$response['result']['parameters']['number1'];","        }","        else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge==\"大於\"?\"pl\":\"pt\";","          $statement = \"&sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].$judge1.\"=\".$response['result']['parameters']['number1'];","        }","      }else{","        if($index==\"price\"){","          $judge = $judge==\"大於\"?\"pl\":\"pt\";","          $judge1 = $judge==\"大於\"?\"pl\":\"pt\";","          $statement = $judge.\"=\".$response['result']['parameters']['number'].\"&\".$judge1.\"=\".$response['result']['parameters']['number1'];","        }else{","          $judge = $judge==\"大於\"?\"igt\":\"ilt\";","          $judge1 = $judge==\"大於\"?\"igt\":\"ilt\";","          $statement = \"&sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'].$judge1.\"=\".$response['result']['parameters']['number1'];","        }","      }","    }","    else if(false == empty($judge)){","      #total 1","      if($index==\"price\"){","        $judge = $judge==\"大於\"?\"pl\":\"pt\";","        $statement = $judge.\"=\".$response['result']['parameters']['number'];","      }","      else{","        $statement = \"sindex=\".$index.\"&\".$judge.\"=\".$response['result']['parameters']['number'];","      }","    }","    }","    $url='http://chatbot-joey820924.c9users.io/stocks?'.$statement;","    $GLOBALS['url'] = $url;","  }","  else if(isset($response['result']['parameters']['Jump'])){","      $url = \"http://chatbot-joey820924.c9users.io/\";","      $jump = [\"訂閱\"=>\"mysubscribe\",\"首頁\"=>\"home\",\"股票大廳\"=>\"stocks\",\"投資組合\"=>\"mystocks\",\"關注清單\"=>\"myfollows\"];","      $url = $url.$jump[$response['result']['parameters']['Jump']];","      $GLOBALS['url'] = $url;","  }","  else if(isset($response['result']['parameters']['allstock'])){","      ","      $url = \"http://chatbot-joey820924.c9users.io/myfollows?allstock=\".$response['result']['parameters']['allstock'];","      $GLOBALS['url'] = $url;","  }","  else if(isset($response['result']['parameters']['Finish'])){","      $url = \"http://chatbot-joey820924.c9users.io/myfollows?finish=leave\";","      $GLOBALS['url'] = $url;","  }","  else if(isset($response)){","        $url = \"http://chatbot-joey820924.c9users.io/myfollows\";","        $GLOBALS['url'] = $url;","        }","?>","<?php","  if(isset($response['result']['fulfillment']['speech'])){","    $speech = $response['result']['fulfillment']['speech'];","  }else{","    $speech = '';","  }","?>","<form name = 'sendForm' action='<?php echo $GLOBALS['url'] ?>' method='POST'>","<input type='hidden' name='speech' value='<?php echo $speech ?>'>","<input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\">","</form>","<script type=\"text/javascript\"> ","","var sjudge = \"<?php echo $speech ?>\";","if(sjudge!=\"\"){","  sendForm.submit();","}","</script>"],"id":42}]]},"ace":{"folds":[],"scrolltop":2463,"scrollleft":0,"selection":{"start":{"row":166,"column":36},"end":{"row":166,"column":36},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":660,"mode":"ace/mode/php"}},"timestamp":1504672971000,"hash":"fba57a2d311f914795b0c4d46453c9b6d3a61636"}